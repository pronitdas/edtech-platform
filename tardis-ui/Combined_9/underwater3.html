<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Underwater Adventure</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #gameCanvas {
            display: none;
            width: 100vw;
            height: 100vh;
        }

        #question {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            background: white;
            padding: 20px;
            border: 2px solid black;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 300px;
        }

        #question p {
            font-size: 18px;
            margin-bottom: 20px;
        }

        #question button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            font-size: 16px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        #question button:hover {
            background-color: #e0e0e0;
        }

        #videoContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: -1;
        }

        #videoContainer video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #instructions {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: sans-serif;
            font-size: 20px;
        }

        #title {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-family: 'Matura MT Script Capitals', cursive;
            font-size: 40px;
            font-weight: bold;
        }

        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        #startButton:hover {
            background-color: #0056b3;
        }

        #scoreboard {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: sans-serif;
            font-size: 18px;
        }
    </style>
</head>

<body>
    <div id="title">Underwater Adventure</div>
    <div id="videoContainer">
        <video id="backgroundVideo" src="background.mp4" loop muted></video>
    </div>
    <canvas id="gameCanvas"></canvas>
    <button id="startButton" onclick="startGame()">Start</button>
    <div id="instructions">Use the arrow keys to move the diver towards the marine creatures and answer the questions.
        Only when you answer all the questions correctly from all the marine creatures, will the diver be able to come
        home to the mermaid.</div>
    <div id="question">
        <p id="questionText"></p>
        <button onclick="answerQuestion(1)">Option 1</button>
        <button onclick="answerQuestion(2)">Option 2</button>
        <button onclick="answerQuestion(3)">Option 3</button>
        <button onclick="answerQuestion(4)">Option 4</button>
    </div>
    <div id="scoreboard">
        <p>Tries: <span id="tries">0</span></p>
        <p>Score: <span id="score">0</span></p>
    </div>
    <audio id="backgroundMusic" loop>
        <source src="under_the_sea.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <script src="game.js"></script>
    <script>
        let tries = 0;
        let score = 0;
        let diverFacingRight = true;
        let diverVisible = true;
        let mermaidVisible = true;

        function startGame() {
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('gameCanvas').style.display = 'block';
            document.getElementById('backgroundVideo').play();
            window.addEventListener('keydown', moveDiver);
            document.getElementById('backgroundMusic').play();
            draw();
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const diverImg = new Image();
        diverImg.src = 'diver.png';
        const obstructionImg = new Image();
        obstructionImg.src = 'obstruction.png';
        const mermaidImg = new Image();
        mermaidImg.src = 'mermaid.png';

        let diver = { x: 50, y: 50, width: 150, height: 100, speed: 5 };
        let obstructions = [
            { x: 225, y: 20, width: 75, height: 100 },
            { x: 520, y: 20, width: 75, height: 100 },
            { x: 830, y: 40, width: 75, height: 100 },
            { x: 580, y: 330, width: 75, height: 100 },
            { x: 900, y: 240, width: 75, height: 100 },
            { x: 1000, y: 470, width: 75, height: 100 },
            { x: 1320, y: 400, width: 75, height: 100 }
        ];
        let currentObstacleIndex = -1;
        let questions = [
            { question: "What is 2 + 2?", correctAnswer: 4, options: [1, 2, 3, 4] },
            { question: "What is the capital of France?", correctAnswer: 3, options: ["Berlin", "Madrid", "Paris", "Rome"] },
            { question: "Which planet is known as the Red Planet?", correctAnswer: 4, options: ["Earth", "Venus", "Jupiter", "Mars"] },
            { question: "What is the largest mammal?", correctAnswer: 2, options: ["Elephant", "Blue Whale", "Giraffe", "Shark"] },
            { question: "What is the smallest prime number?", correctAnswer: 1, options: [2, 3, 5, 7] },
            { question: "How many continents are there?", correctAnswer: 2, options: [5, 7, 6, 8] },
            { question: "What is the boiling point of water?", correctAnswer: 3, options: ["90째C", "80째C", "100째C", "70째C"] }
        ];

        function moveDiver(e) {
            if (currentObstacleIndex === -1) {
                if (e.key === 'ArrowUp') diver.y -= diver.speed;
                if (e.key === 'ArrowDown') diver.y += diver.speed;
                if (e.key === 'ArrowLeft') {
                    diver.x -= diver.speed;
                    diverFacingRight = false;
                }
                if (e.key === 'ArrowRight') {
                    diver.x += diver.speed;
                    diverFacingRight = true;
                }
            }
            checkCollision();
            draw();
        }

        function checkCollision() {
            obstructions.forEach((ob, index) => {
                if (diver.x < ob.x + ob.width &&
                    diver.x + diver.width > ob.x &&
                    diver.y < ob.y + ob.height &&
                    diver.height + diver.y > ob.y) {
                    currentObstacleIndex = index;
                    showQuestion();
                }
            });

            if (obstructions.length === 0 && diver.x + diver.width > 1400 && diver.y + diver.height > 400) {
                moveToMermaid();
            }
        }

        function showQuestion() {
            let questionData = questions[currentObstacleIndex];
            document.getElementById('questionText').innerText = questionData.question;
            let buttons = document.querySelectorAll('#question button');
            buttons.forEach((button, index) => {
                button.innerText = questionData.options[index];
                button.setAttribute('data-answer', index + 1);
            });
            document.getElementById('question').style.display = 'block';
        }

        function answerQuestion(answer) {
            let questionData = questions[currentObstacleIndex];
            tries++;
            document.getElementById('tries').innerText = tries;
            if (parseInt(answer) === questionData.correctAnswer) {
                score++;
                document.getElementById('score').innerText = score;
                obstructions.splice(currentObstacleIndex, 1); // Remove the correct obstruction
                questions.splice(currentObstacleIndex, 1); // Remove the answered question
                document.getElementById('question').style.display = 'none';
                currentObstacleIndex = -1;
                if (obstructions.length === 0) {
                    diver.destination = { x: 1400, y: 400 }; // Move towards the mermaid
                }
            } else {
                alert('Wrong answer! Try again.');
            }
        }

        function moveToMermaid() {
            const interval = setInterval(() => {
                if (diver.x < 1400) {
                    diver.x += diver.speed;
                    draw();
                } else {
                    clearInterval(interval);
                    diverAndMermaidDisappear();
                }
            }, 50);
        }

        function diverAndMermaidDisappear() {
            const interval = setInterval(() => {
                if (diver.width > 0) {
                    diver.width -= 2;
                    diver.height -= 1.33;
                }
                if (mermaidVisible) {
                    mermaidVisible = false;
                }
                draw();
                if (diver.width <= 0) {
                    diverVisible = false;
                    clearInterval(interval);
                }
            }, 50);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            if (diverVisible) {
                if (!diverFacingRight) {
                    ctx.scale(-1, 1);
                    ctx.drawImage(diverImg, -diver.x - diver.width, diver.y, diver.width, diver.height);
                } else {
                    ctx.drawImage(diverImg, diver.x, diver.y, diver.width, diver.height);
                }
            }
            ctx.restore();
            obstructions.forEach(ob => {
                ctx.drawImage(obstructionImg, ob.x, ob.y, ob.width, ob.height);
            });
            if (obstructions.length === 0 && mermaidVisible) {
                ctx.drawImage(mermaidImg, 1400, 400, 150, 150); // Draw the mermaid
            }
        }

        diverImg.onload = () => {
            obstructionImg.onload = () => {
                mermaidImg.onload = () => {
                    draw();
                };
            };
        };
    </script>
</body>

</html>