<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Marketing Communication Roleplay</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: url('https://via.placeholder.com/800x600.png?text=Default+Background+Scene') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #game-container {
            width: 90%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3);
            border-radius: 20px;
        }

        .speech-bubble {
            background: #f8d568;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            position: relative;
            color: #333;
        }

        .speech-bubble:after {
            content: "";
            position: absolute;
            bottom: -15px;
            left: 20px;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: #f8d568;
        }

        #mentor-image,
        #character-image,
        #skeptical-image,
        #impactful-image {
            width: 150px;
            height: 150px;
            background: url('https://via.placeholder.com/150.png?text=Character') no-repeat center center;
            background-size: cover;
            border-radius: 50%;
            margin-bottom: 15px;
        }

        #user-response {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 15px;
            border: 1px solid #ccc;
        }

        button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            background-color: #ff9800;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #e68900;
        }

        .character-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <h1>Welcome to Integrated Marketing Communication Roleplay</h1>
        <div id="mentor-output">
            <div class="character-container">
                <div id="mentor-image"></div>
                <div id="mentor-bubble" class="speech-bubble">
                    Hello, I'm AI-Mentor! Let's start your journey in integrated marketing communication. Please tell me
                    about your experience in marketing and any background information you'd like to share.
                </div>
            </div>
        </div>
        <div id="skeptical-output" style="display: none;">
            <div class="character-container">
                <div id="skeptical-image"></div>
                <div id="skeptical-bubble" class="speech-bubble">
                    I'm Skeptical Sam. Convince me why your idea is even worth considering.
                </div>
            </div>
        </div>
        <div id="impactful-output" style="display: none;">
            <div class="character-container">
                <div id="impactful-image"></div>
                <div id="impactful-bubble" class="speech-bubble">
                    Hi there! I'm Impactful Ivy. I'm looking for campaigns that really make a difference. Show me what
                    you've got!
                </div>
            </div>
        </div>
        <div id="user-input">
            <textarea id="user-response" placeholder="Type your response here..."></textarea>
            <button onclick="nextStep()">Submit</button>
        </div>
    </div>

    <script>
        const openAiApiKey = "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";
        let step = 1;
        let userExperience = "";
        const imageCache = {};

        async function getOpenAIResponse(prompt, retryCount = 3) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openAiApiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.7,
                        max_tokens: 150
                    })
                });

                if (!response.ok) {
                    console.error(`OpenAI API returned an error: ${response.status} ${response.statusText}`);
                    if (retryCount > 0) {
                        console.log("Retrying... Attempts left: " + retryCount);
                        return await getOpenAIResponse(prompt, retryCount - 1);
                    }
                    return "There was an issue fetching the response from OpenAI. Please try again later.";
                }

                const data = await response.json();
                if (data?.choices?.length > 0 && data.choices[0].message?.content) {
                    return data.choices[0].message.content;
                } else {
                    console.warn("Unexpected response structure:", data);
                    return "I couldn't generate a response. Please try again.";
                }
            } catch (error) {
                console.error("Error fetching data from OpenAI: ", error);
                if (retryCount > 0) {
                    console.log("Retrying... Attempts left: " + retryCount);
                    return await getOpenAIResponse(prompt, retryCount - 1);
                }
                return "I'm having trouble connecting to the OpenAI server. Please try again later.";
            }
        }

        async function getDallEImage(prompt) {
            if (imageCache[prompt]) {
                return imageCache[prompt];
            }
            try {
                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openAiApiKey}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        n: 1,
                        size: "256x256"
                    })
                });
                const data = await response.json();
                if (data.data && data.data.length > 0) {
                    const imageUrl = data.data[0].url;
                    imageCache[prompt] = imageUrl;
                    return imageUrl;
                } else {
                    return "https://via.placeholder.com/256.png?text=No+Image";
                }
            } catch (error) {
                console.error("Error fetching image from DALL-E: ", error);
                return "https://via.placeholder.com/256.png?text=Error";
            }
        }

        async function nextStep() {
            const userResponse = document.getElementById('user-response').value;
            if (userResponse.trim() === "") {
                alert("Please provide your response.");
                return;
            }

            switch (step) {
                case 1:
                    userExperience = userResponse;
                    let mentorText1 = "Thank you for sharing! Let's create a scenario based on your input. Here are three possible scenarios for you to choose from:";
                    mentorText1 += "\n1. Create an advertisement for a chocolate brand.";
                    mentorText1 += "\n2. Handle sales promotion for a jewelry company.";
                    mentorText1 += "\n3. Create a brand slogan in a metaverse setting.";
                    updateMentorOutput(mentorText1);
                    break;
                case 2:
                    let scenarioChoice = parseInt(userResponse);
                    if (isNaN(scenarioChoice) || scenarioChoice < 1 || scenarioChoice > 3) {
                        alert("Please choose a valid option (1, 2, or 3).");
                        return;
                    }

                    const scenarioDescriptions = [
                        "You will be creating an advertisement for a new chocolate product. Your goal is to make the customer excited about this delicious new offering.",
                        "You will be handling sales promotion for a jewelry company, working with retailers to maximize sales.",
                        "You are in a futuristic setting where you need to come up with a compelling brand slogan for a product in the metaverse."
                    ];

                    const backgroundImage = await getDallEImage(scenarioDescriptions[scenarioChoice - 1]);
                    document.body.style.backgroundImage = `url(${backgroundImage})`;

                    let mentorImageUrl = await getDallEImage(`Character for mentor in scenario: ${scenarioDescriptions[scenarioChoice - 1]}`);
                    document.getElementById('mentor-image').style.backgroundImage = `url(${mentorImageUrl})`;

                    let skepticalImageUrl = await getDallEImage(`Male character, Skeptical Sam, for scenario: ${scenarioDescriptions[scenarioChoice - 1]}`);
                    document.getElementById('skeptical-image').style.backgroundImage = `url(${skepticalImageUrl})`;

                    let impactfulImageUrl = await getDallEImage(`Female character, Impactful Ivy, for scenario: ${scenarioDescriptions[scenarioChoice - 1]}`);
                    document.getElementById('impactful-image').style.backgroundImage = `url(${impactfulImageUrl})`;

                    updateMentorOutput(scenarioDescriptions[scenarioChoice - 1] + "\n\nBEGIN ROLE PLAY!");
                    document.getElementById('skeptical-output').style.display = 'flex';
                    document.getElementById('impactful-output').style.display = 'flex';
                    break;
                case 3:
                    let skepticalResponse = await getOpenAIResponse("Skeptical point of view: " + userExperience + "\n\n" + userResponse);
                    document.getElementById('skeptical-bubble').innerText = skepticalResponse;

                    let impactfulResponse = await getOpenAIResponse("Impactful campaign point of view: " + userExperience + "\n\n" + userResponse);
                    document.getElementById('impactful-bubble').innerText = impactfulResponse;
                    break;
                case 4:
                    let feedbackResponse = "GENERAL FEEDBACK: Based on your performance, you did really well on focusing on the main objective, but you could work more on involving emotional appeal in your messages.\n\nADVICE MOVING FORWARD: Remember to keep the target audience's emotions in mind, and use compelling language to connect with them more deeply. This will help in making your marketing communication more effective.";
                    let score = Math.floor(Math.random() * 41) + 60; // Score between 60-100
                    feedbackResponse += `\n\nYour Score: ${score}/100`;
                    updateMentorOutput(feedbackResponse);
                    break;
                case 5:
                    let summary = "SUMMARY OF STRENGTHS AND WEAKNESSES:\n\nStrengths: You effectively identified the main objectives and addressed key points of the scenario.\n\nWeaknesses: Try to add more emotional appeal and think about how your message will resonate on a deeper level with the target audience.";
                    updateMentorOutput(summary);
                    break;
                default:
                    updateMentorOutput("If you have more questions or want to try another scenario, feel free to ask!");
                    break;
            }
            step++;
            document.getElementById('user-response').value = "";
            document.getElementById('user-response').focus();
        }

        function updateMentorOutput(text) {
            document.getElementById('mentor-bubble').innerText = text;
        }
    </script>
</body>

</html>